<!-- Header -->
<header th:fragment="header" class="header-main bg-mode-re header-light fixed-top header-height header-option-1"
        style="top: 0px;">
    <!-- Header Top -->
    <div class="header-top small bg-black small">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center"><!-- Left -->
                <div class="d-flex align-items-center justify-content-center d-none d-lg-block">
                    <ul class="nav white-link">
                        <li class="nav-item me-3 text-white text-opacity-85"><span><i class="bi bi-clock me-2"></i>
                                Visit time: Mon-Sat 9:00-19:00</span></li>
                        <li class="nav-item"><a href="#" class="navbar-link"><i class="bi bi-headset me-2"></i>
                            Call us now: +886 3425 1108</a></li>
                    </ul>
                </div>
                <!-- Right -->
                <div class="d-flex align-items-center justify-content-center w-100 w-lg-auto"><!-- Language -->
                    <div class="dropdown ms-0 ms-lg-3">
                    </div>
                    <!-- Top link -->
                    <ul class="nav ms-auto ms-lg-3">
                        <li class="nav-item h-switch dropdown">
                            <button
                                    class="theme-switch nav-link text-white dropdown-toggle" id="bd-theme"
                                    type="button" aria-expanded="false" data-bs-toggle="dropdown"
                                    data-bs-display="static" style=""><span class="bi my-1 theme-icon-active"
                                                                            style=""><i class="bi-sun-fill"
                                                                                        style=""></i> </span><span
                                    class="d-none">Toggle theme</span></button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme" style="">
                                <li>
                                    <button type="button" class="dropdown-item active"
                                            data-bs-theme-value="light"><span
                                            class="bi me-2 opacity-50 theme-icon"><i class="bi-sun-fill"></i>
                                                </span>Light <span class="bi ms-auto d-none"><i
                                            class="bi-check2"></i></span></button>
                                </li>
                                <li>
                                    <button type="button" class="dropdown-item" data-bs-theme-value="dark"><span
                                            class="bi me-2 opacity-50 theme-icon"><i
                                            class="bi-moon-stars-fill"></i> </span>Dark <span
                                            class="bi ms-auto d-none"><i class="bi-check2"></i></span></button>
                                </li>
                                <li>
                                    <button type="button" class="dropdown-item" data-bs-theme-value="auto"><span
                                            class="bi me-2 opacity-50 theme-icon"><i class="bi-circle-half"></i>
                                                </span>Auto <span class="bi ms-auto d-none"><i
                                            class="bi-check2"></i></span></button>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item"><a href="#" class="nav-link text-white" data-bs-toggle="modal"
                                                data-bs-target="#topbarlogin" th:unless="${session.loginsuccess}"><i
                                class="fi-user me-2"></i>登入</a></li>
                        <!--                        <li class="nav-item"><a th:href="@{frontend/member/loginpopup.html}" class="nav-link text-white" data-bs-toggle="modal"-->
                        <!--                                                data-bs-target="#topbarlogin"><i class="fi-user me-2"></i>Login</a></li>-->
                    </ul><!-- Top social -->
                    <div class="nav header-social justify-content-end d-none d-lg-block white-link"><a
                            class="h-social-link" href="#"><i class="bi bi-facebook"></i></a> <a class="h-social-link"
                                                                                                 href="#"><i
                            class="bi bi-twitter"></i></a> <a class="h-social-link" href="#"><i
                            class="bi bi-linkedin"></i></a></div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Header Top -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container"><!-- Logo -->
            <a class="navbar-brand" th:href="@{/}">
                <img class="logo-dark" th:src="@{/frontend/assets/img/weblogo.svg}" title="" alt="">
                <img class="logo-light" th:src="@{/frontend/assets/img/weblogo-light.svg}" title="" alt="">
            </a>
            <!-- Logo -->
            <!-- Menu -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mx-auto">
                    <li class="dropdown nav-item"><a href="#" class="nav-link">關於我們</a> <label
                            class="px-dropdown-toggle mob-menu"></label>
                        <ul class="dropdown-menu left shadow-lg">
                                <li><a class="dropdown-item" th:href="@{/frontend/news/selectNews}">最新消息</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/service/faq}">常見問題</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/service/frontendServiceChat}">聯繫客服</a>
                            <li><a class="dropdown-item" th:href="@{/frontend/service/contactus}">聯繫我們</a></li>
                        </ul>
                    </li>
                    <li class="dropdown nav-item"><a href="#" class="nav-link">商品專區</a> <label
                            class="px-dropdown-toggle mob-menu"></label>
                        <ul class="dropdown-menu left shadow-lg">
                            <li><a class="dropdown-item" th:href="@{/frontend/product/visitProduct}">最新上市</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/product/visitProduct}">最熱門商品</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/product/visitProduct}">女士專區</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/product/visitProduct}">男士專區</a></li>
                        </ul>
                    </li>
                    <li class="dropdown nav-item"><a href="#" class="nav-link">租借品專區</a> <label
                            class="px-dropdown-toggle mob-menu"></label>
                        <ul class="dropdown-menu left shadow-lg">
                            <li><a class="dropdown-item" th:href="@{/frontend/rental/rentalShop}">瀏覽租借品</a></li>
                            <li><a class="dropdown-item" th:href="@{/frontend/rental/rentalInstructions}">租借須知</a></li>
                        </ul>
                    </li>
                    <li class="dropdown nav-item"><a href="#" class="nav-link">專欄文章</a> <label
                            class="px-dropdown-toggle mob-menu"></label>
                        <ul class="dropdown-menu left shadow-lg">
                            <li><a class="dropdown-item" th:href="@{/frontend/columnarticle/listAllColumnArticle}">全部專欄文章</a></li>
                            <li><a class="dropdown-item" th:if="${session.loginsuccess}" th:unless="${session.onePublishedArticles == null}" th:href="@{/frontend/columnarticle/oneColumnArticle(artNo=${session.onePublishedArticles})}">推薦的專欄文章</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        <!-- End Menu -->
        <div class="nav flex-nowrap align-items-center header-right"><!-- Nav Search-->
            <div class="nav-item"><a class="nav-link collapsed" data-bs-toggle="collapse" href="javascript:void(0)"
                                     data-bs-target="#search-open" aria-expanded="false"><i class="fi-search"></i></a>
            </div>
            <!-- Acount -->
            <div class="nav-item dropdown"><a class="nav-link" href="#" role="button" id="dropdown_myaccount"
                   data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i
                    class="fi-user"></i></a>
                <div class="dropdown-menu dropdown-menu-end mt-2 shadow" aria-labelledby="dropdown_myaccount">
                    <div class="d-flex flex-column align-items-center">
                        <a class="dropdown-item" th:href="@{/frontend/member/loginMember}" th:unless="${session.loginsuccess}">登入</a>
                        <a class="dropdown-item" th:href="@{/frontend/member/addMemberData}" th:unless="${session.loginsuccess}">註冊</a>
                        <img th:src="@{/frontend/member/picture(memno=${session.loginsuccess.getMemNo()})}"
                             id="memberAvatar"
                             style="width: 80px; height: 80px; border: 1px solid #ccc;"
                             alt="會員大頭貼"
                             th:if="${session.loginsuccess}">
                        <a class="dropdown-item" th:href="@{/frontend/rentalmytrack/toRentalMyTrack}" th:if="${session.loginsuccess}">追蹤清單</a>
                        <a class="dropdown-item" th:href="@{/frontend/member/memberData}" th:if="${session.loginsuccess}">個人資訊</a>
                        <a class="dropdown-item" th:href="@{/frontend/member/logoutMember}" th:if="${session.loginsuccess}">登出</a>
                    </div>
                </div>
            </div>
            <!-- Member Notice -->
            <div class="nav-item dropdown">
                <a class="nav-link" href="#" role="button" id="dropdown_notice" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="bi bi-bell"></i>
                    <span style="position: absolute; top: 9px; right: 3px; width: 15px; height: 15px; background-color: red; border-radius: 60%; display: flex; justify-content: center; align-items: center; font-size: 10px; color: white;"
                            class="badge bg-danger"
                            th:text="${session.unreadNoticeCount}"
                            th:if="${session.unreadNoticeCount > 0}">
                    </span>
                </a>
                <div class="dropdown-menu dropdown-menu-end mt-2 shadow" aria-labelledby="dropdown_mynotice">
                    <div class="d-flex flex-column align-items-center">
                        <!-- Show login prompt if not logged in -->
                        <a class="dropdown-item" th:href="@{/frontend/member/loginMember}" th:unless="${session.loginsuccess}">
                            尚未登入，請登入查看個人訊息
                        </a>
                        <!-- Show notifications if logged in and there are notifications -->
                        <div th:if="${session.loginsuccess}">
                            <a class="dropdown-item"
                               th:href="@{/frontend/notice/memberNoticeData}"
                               th:if="${session.unreadNoticeCount > 0}">
                                你有未讀通知，請前往查看
                            </a>
                            <a class="dropdown-item"
                               th:href="@{/frontend/notice/memberNoticeData}"
                               th:if="${session.unreadNoticeCount == 0}">
                                你沒有未讀訊息，但可以點此查看過往訊息
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Wishlist -->
            <div class="nav-item dropdown">
                <a class="nav-link" href="#" role="button" id="dropdown_wish" data-bs-toggle="dropdown"
                   aria-haspopup="true" aria-expanded="false"><i class="fi-heart"></i></a>
                <div class="dropdown-menu dropdown-menu-end mt-2 shadow" aria-labelledby="dropdown_wish">
                    <div class="d-flex flex-column align-items-center">
                        <!--  若未登入   -->
                        <a class="dropdown-item" th:href="@{/frontend/member/loginMember}" th:unless="${session.loginsuccess}">我的最愛清單 (商品)</a>
                        <a class="dropdown-item" th:href="@{/frontend/member/loginMember}" th:unless="${session.loginsuccess}">我的最愛清單 (租借品)</a>
                        <!--  若已登入   -->
                        <a class="dropdown-item" th:href="@{/frontend/productmyfavorite/myProductFAV}" th:if="${session.loginsuccess}">我的最愛清單 (商品)</a>
                        <a class="dropdown-item" th:href="@{/frontend/rentalmyfavorite/myRentalFAV}" th:if="${session.loginsuccess}">我的最愛清單 (租借品)</a>
                    </div>
                </div>
            </div>
            <!-- Cart -->
            <div class="nav-item">
                <a class="nav-link" data-bs-toggle="offcanvas" href="#modalMiniCart" role="button" aria-controls="modalMiniCart" onclick="updateMiniCart()">
<!--                    <span class="" data-cart-items="8">-->
                        <i class="fi-shopping-cart"></i>
<!--                    </span>-->
                </a>
            </div>
            <!-- Mobile Toggle -->
            <button
                    class="navbar-toggler ms-2" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation"><span
                    class="px-navbar-toggler-icon"></span></button><!-- End Mobile Toggle -->
        </div>
        </div>
    </nav>
    <style>
        .product-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        .product-item:last-child {
            border-bottom: none;
        }

        .product-image img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 10px;
        }

        .product-details {
            flex-grow: 1;
        }

        .product-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .product-price, .product-quantity {
            font-size: 12px;
            color: #555;
        }
    </style>
    <script>
        import data from "../../../static/frontend/assets/vendor/bootstrap/js/src/dom/data";

        function updateMiniCart() {
            $.ajax({
                type: 'GET',
                url: "/frontend/cart/minicart",
                success: function(response) {
                    var productListContainer = document.getElementById("productListContainer");
                    productListContainer.innerHTML = ''; // 清空之前的内容

                    if (response.error) {
                        // 处理用户未登录的情况
                        console.log(response.error);
                        return;
                    }

                    var cartItems = response.cartItems; // 直接获取 cartItems 数组

                    cartItems.forEach(function(item) {
                        var productItem = document.createElement("div");
                        productItem.classList.add("product-item");
                        productItem.innerHTML = `
                    <div class="product-image">
                        <img src="data:image/jpeg;base64,${item.firstPic}" alt="${item.productName}">
                    </div>
                    <div class="product-details">
                        <div class="product-name">${item.productName}</div>
                        <div class="product-price">價格: ${item.productPrice}</div>
                        <div class="product-quantity">數量: ${item.productBuyQty}</div>
                    </div>
                `;
                        productListContainer.appendChild(productItem);
                    });

                    // 计算总金额
                    var totalPrice = 0;
                    cartItems.forEach(function(item) {
                        var productPrice = parseFloat(item.productPrice);
                        var productQty = parseInt(item.productBuyQty);
                        totalPrice += productPrice * productQty;
                    });

                    // 显示总金额
                    document.getElementById('AllPrice').textContent = '總金額: ' + totalPrice; // 假设价格是小数，保留两位小数
                },
                error: function(error) {
                    console.log("Error:", error);
                }
            });
        }

        function updateRentalMiniCart() {

            let baseUrl = window.location.protocol + "//" + window.location.host;
            let apiPath = "frontend/rentalorder/"

            fetch(baseUrl + apiPath + "getFromCart").then(response => response.json()).then(data => {

                let rentalContainer = $("div#rentalListContainer");
                rentalContainer.innerHTML = ""; // 清空之前的内容

                Object.entries(data).forEach(([key, item]) => {



                });

            });

        }

    </script>
</header>
<!-- End Header -->
