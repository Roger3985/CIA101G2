<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="pxdraft">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template">
    <meta name="description" content="ShopApp - eCommerce Bootstrap 5 Template">
    <!-- title -->
    <title>一般商品</title>
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/logo/favicon.ico}">
    <!-- CSS Template -->
    <th:block th:include="~{frontend/component/plugin/frontendplugin.html :: css}"></th:block>
</head>

<body>
<!-- 通用插件 -->
<th:block th:replace="frontend/component/plugin/frontendplugin :: components"></th:block>
<!-- 通用插件 -->
<!--
========================
    Wrapper
========================
-->
<div class="wrapper">
    <!-- header height -->
    <div class="header-height-bar" style="min-height: 114.406px;"></div>
    <!-- Header -->
    <header th:replace="frontend/component/header :: header"></header>
    <!-- End Header -->
    <!-- Main -->
    <main>
        <!-- Breadcrumb -->
        <div class="py-3 bg-gray-100">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 my-2">
                        <h1 class="m-0 h4 text-center text-lg-start">Shop</h1>
                    </div>
                    <div class="col-lg-6 my-2">
                        <ol class="breadcrumb m-0 small justify-content-center justify-content-lg-end">
                            <li class="breadcrumb-item">
                                <a class="text-nowrap text-reset" th:href="@{/}">首頁</a>
                            </li>
                            <li class="breadcrumb-item text-nowrap active" aria-current="page">商品</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Breadcrumb -->
        <!-- Shop -->
        <section class="py-6">
            <div class="container">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-lg-4 col-xl-3 pe-xl-5 offcanvas-lg offcanvas-start px-0 px-lg-3" tabindex="-1"
                         id="shop_filter" aria-labelledby="shop_filterLabel">
                        <div class="offcanvas-header border-bottom">
                            <h5 class="offcanvas-title" id="shop_filterLabel">商品過濾器</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#shop_filter" aria-label="Close"></button>
                        </div>
                        <div class="offcanvas-body flex-column">
                            <!-- Categories -->
<!--                            <div class="shop-sidebar-block">-->
<!--                                <div class="shop-sidebar-title">-->
<!--                                    <a class="h5" data-bs-toggle="collapse" href="#shop_categories" role="button" aria-expanded="true" aria-controls="shop_categories">類別<i class="bi bi-chevron-up"></i></a>-->
<!--                                </div>-->
<!--                                <div class="shop-category-list collapse show" id="shop_categories">-->
<!--                                    <ul class="nav flex-column">-->
<!--                                        <li class="nav-item">-->
<!--                                            <a href="#" class="nav-link active">所有商品</a>-->
<!--                                        </li>-->
<!--                                        <li class="nav-item">-->
<!--                                            <a href="#" class="nav-link">男性</a>-->
<!--                                            <a data-bs-toggle="collapse" href="#shop_cat_1" role="button"-->
<!--                                               aria-expanded="false" aria-controls="shop_cat_1" class="s-icon"></a>-->
<!--                                            <div class="collapse" id="shop_cat_1">-->
<!--                                                <ul class="nav nav-pills flex-column nav-hierarchy">-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">西裝</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">襯衫</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">配件</a>-->
<!--                                                    </li>-->
<!--                                                </ul>-->
<!--                                            </div>-->
<!--                                        </li>-->
<!--                                        <li class="nav-item">-->
<!--                                            <a href="#" class="nav-link">女性</a>-->
<!--                                            <a data-bs-toggle="collapse" href="#shop_cat_2" role="button"-->
<!--                                               aria-expanded="false" aria-controls="shop_cat_2" class="s-icon"></a>-->
<!--                                            <div class="collapse" id="shop_cat_2">-->
<!--                                                <ul class="nav nav-pills flex-column nav-hierarchy">-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">禮服</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">婚紗</a>-->
<!--                                                    </li>-->
<!--                                                    <li class="nav-item">-->
<!--                                                        <a href="#" class="nav-link">配件</a>-->
<!--                                                    </li>-->
<!--                                                </ul>-->
<!--                                            </div>-->
<!--                                        </li>-->
<!--                                    </ul>-->
<!--                                </div>-->
<!--                            </div>-->
                            <!-- End Categories -->
                            <!-- Color -->
                            <div class="shop-sidebar-block">
                                <div class="shop-sidebar-title">
                                    <a class="h5" data-bs-toggle="collapse" href="#shop_Color" role="button"
                                       aria-expanded="true" aria-controls="shop_Color">Color <i
                                            class="bi bi-chevron-up"></i></a>
                                </div>
                                <div class="shop-sidebar-list collapse show" id="shop_Color">
                                    <ul>
                                        <li class="custom-checkbox checkbox-color">
                                            <input class="custom-control-input filter-checkbox" id="colorsidebar1" type="checkbox"
                                                   data-filter="color" data-value="藍色">
                                            <label class="custom-control-label" style="color: #1F45FC;"
                                                   for="colorsidebar1">
                                                <span class="text-body">藍色</span>
                                            </label>
                                        </li>
                                        <li class="custom-checkbox checkbox-color">
                                            <input class="custom-control-input filter-checkbox" id="colorsidebar2" type="checkbox"
                                                   data-filter="color" data-value="黃色">
                                            <label class="custom-control-label" style="color: #FCD71E;"
                                                   for="colorsidebar2">
                                                <span class="text-body">黃色</span>
                                            </label>
                                        </li>
                                        <li class="custom-checkbox checkbox-color">
                                            <input class="custom-control-input filter-checkbox" id="colorsidebar3" type="checkbox"
                                                   data-filter="color" data-value="黑色">
                                            <label class="custom-control-label" style="color: #000;"
                                                   for="colorsidebar3">
                                                <span class="text-body">黑色</span>
                                            </label>
                                        </li>
                                        <li class="custom-checkbox checkbox-color">
                                            <input class="custom-control-input filter-checkbox" id="colorsidebar4" type="checkbox"
                                                   data-filter="color" data-value="紅色">
                                            <label class="custom-control-label" style="color: #f73636;"
                                                   for="colorsidebar4">
                                                <span class="text-body">紅色</span>
                                            </label>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!-- End Color -->
                            <!-- 大小size -->
                            <div class="shop-sidebar-block">
                                <div class="shop-sidebar-title">
                                    <a class="h5" data-bs-toggle="collapse" href="#shop_brand" role="button"
                                       aria-expanded="true" aria-controls="shop_brand">
                                        Size <i class="bi bi-chevron-up"></i>
                                    </a>
                                </div>
                                <div class="shop-sidebar-list collapse show" id="shop_brand">
                                    <ul>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand1" type="checkbox"
                                                   data-filter="size" data-value="0">
                                            <label class="custom-control-label" for="brand1">XS</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand2" type="checkbox"
                                                   data-filter="size" data-value="1">
                                            <label class="custom-control-label" for="brand2">S</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand3" type="checkbox"
                                                   data-filter="size" data-value="2">
                                            <label class="custom-control-label" for="brand3">M</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand4" type="checkbox"
                                                   data-filter="size" data-value="3">
                                            <label class="custom-control-label" for="brand4">L</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand5" type="checkbox"
                                                   data-filter="size" data-value="4">
                                            <label class="custom-control-label" for="brand5">XL</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="brand6" type="checkbox"
                                                   data-filter="size" data-value="5">
                                            <label class="custom-control-label" for="brand6">2L</label>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <!-- Size結束 -->
                            <!-- Brands -->
                            <div class="shop-sidebar-block">
                                <div class="shop-sidebar-title">
                                    <a class="h5" data-bs-toggle="collapse" href="#shop_price" role="button"
                                       aria-expanded="true" aria-controls="shop_price">Price <i
                                            class="bi bi-chevron-up"></i></a>
                                </div>
                                <div class="shop-sidebar-list collapse show" id="shop_price">
                                    <ul>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="price1" type="checkbox"
                                                   data-filter="price" data-value="2000-5000">
                                            <label class="custom-control-label" for="price1">$2000 - $5000</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="price2" type="checkbox"
                                                   data-filter="price" data-value="5000-10000">
                                            <label class="custom-control-label" for="price2">$5000 - $10000</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="price3" type="checkbox"
                                                   data-filter="price" data-value="10000-20000">
                                            <label class="custom-control-label" for="price3">$10000 - $20000</label>
                                        </li>
                                        <li class="custom-checkbox">
                                            <input class="custom-control-input filter-checkbox" id="price4" type="checkbox"
                                                   data-filter="price" data-value="20000-above">
                                            <label class="custom-control-label" for="price4">$20000 以上</label>
                                        </li>
                                    </ul>
<!--                                    <div class="d-flex align-items-center pt-3">-->
<!--                                        <input type="number" id="minPrice" class="form-control form-control-sm" placeholder="$2000">-->
<!--                                        <div class="text-gray-350 mx-2">‒</div>-->
<!--                                        <input type="number" id="maxPrice" class="form-control form-control-sm" placeholder="$40000">-->
<!--                                    </div>-->
                                </div>
                            </div>
                            <!-- End Brands -->
                        </div>
                    </div>
                    <!-- End Sidebar -->
                    <!-- Product Box -->
                    <!-- 商品過濾 -->
                    <div class="col-lg-8 col-xl-9">
                        <div class="shop-top-bar d-flex pb-3">
                            <div class="layout-change me-auto">
                                <!-- Mobile Toggle -->
                                <button class="btn btn-sm d-lg-none" type="button" data-bs-toggle="offcanvas"
                                        data-bs-target="#shop_filter" aria-controls="shop_filter">
                                    <i class="fs-4 lh-1 bi bi-justify-left"></i>
                                </button>
                                <!-- End Mobile Toggle -->
                                <a class="btn btn-sm active" href="#">
                                    <i class="bi bi-grid"></i>
                                </a>
                                <a class="btn btn-sm" th:href="@{/frontend/product/visitProduct-list}">
                                    <i class="bi bi-view-stacked"></i>
                                </a>
                            </div>
                            <div class="d-flex align-items-center ms-3">
                                <button class="btn btn-sm btn-primary me-2 sort-button" data-sort="newest">最新上市
                                </button>
                                <button class="btn btn-sm btn-success me-2 sort-button" data-sort="highestRating">
                                    評價最高
                                </button>
                                <button class="btn btn-sm btn-info me-2 sort-button" data-sort="popular">熱門商品
                                </button>
                            </div>
<!--                            <div class="shortby-dropdown ms-auto">-->
<!--                                <div class="dropdown">-->
<!--                                    <a class="btn btn-none btn-sm border dropdown-toggle text-mode" href="#"-->
<!--                                       role="button" id="dropdownMenuLink" data-bs-toggle="dropdown"-->
<!--                                       aria-expanded="false">Short by</a>-->
<!--                                    <ul class="dropdown-menu dropdown-menu-end shadow"-->
<!--                                        aria-labelledby="dropdownMenuLink">-->
<!--                                        <li><a class="dropdown-item" href="#">特色</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">最暢銷</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">依字母順序-順序</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">依字母順序-倒序</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">價格由低到高</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">價格由高到低</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">依上市時間排序-順序</a></li>-->
<!--                                        <li><a class="dropdown-item" href="#">依上市時間排序-倒序</a></li>-->
<!--                                    </ul>-->
<!--                                </div>-->
<!--                            </div>-->
                        </div>
                        <!-- 商品相關 -->
                        <!-- Product Box -->
                        <div id="product-container" th:fragment="product-list">
                            <div class="row g-3">
                                <div class="col-sm-6 col-lg-4" th:each="productDTO, iterStat : ${productDTOList}">
                                    <div class="product-card-1">
                                        <div class="product-card-image">
                                            <div th:if="${iterStat.index < newProductList.size() and newProductList[iterStat.index]}"
                                                 class="badge-ribbon">
                                                <span class="badge bg-danger">最新上市</span>
                                            </div>
                                            <div class="product-action productitm">
                                                <div class="addToFAVBtn">
                                                    <a class="btn btn-outline-primary">
                                                        <input type="hidden" name="productNo"
                                                               th:value="${productDTO.productNoList.get(0)}">
                                                        <i class="fi-heart"></i>
                                                    </a>
                                                </div>
                                                <a href="#" class="btn btn-outline-primary">
                                                    <i class="fi-repeat"></i>
                                                </a>
<!--                                                <a data-bs-toggle="modal" data-bs-target="#px-quick-view"-->
<!--                                                   href="javascript:void(0)" class="btn btn-outline-primary">-->
<!--                                                    <i class="fi-eye"></i>-->
<!--                                                </a>-->
                                            </div>
                                            <div class="product-media productitm">
                                                <a th:href="@{/frontend/product/oneProduct(productNo=${productDTO.productNoList.get(0)})}">
                                                    <img class="img-fluid" th:src="@{/frontend/productpicture/DBPhotoReader(productPicNo=${productDTO.productPicNoList.get(0)})}" title="" alt="">
                                                </a>
                                                <div class="product-cart-btn addToCartBtn">
                                                    <input type="hidden" name="productNo"
                                                           th:value="${productDTO.productNoList.get(0)}">
                                                    <!-- Product number -->
                                                    <input type="hidden" name="productBuyQty" th:value="1">
                                                    <!-- Quantity -->
                                                    <a class="btn btn-primary btn-sm w-100 "><i
                                                            class="fi-shopping-cart"></i> Add to cart</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="product-card-info">
                                            <div class="product-meta small">
                                                <a th:href="@{/frontend/product/oneProduct(productNo=${productDTO.productNoList.get(0)})}"
                                                   th:text="${productDTO.productCatName}">

                                                </a>
                                            </div>
                                            <div class="rating-star text">
                                                <th:block th:each="star : ${#numbers.sequence(1, 5)}">
                                                    <i th:classappend="${star <= productDTO.productScore ? 'bi bi-star-fill star' : (star - 0.5 <= productDTO.productScore ? 'bi bi-star-half star-half' : 'bi bi-star star-empty')}"></i>
                                                </th:block>
                                            </div>
                                            <h6 class="product-title">
                                                <a th:href="@{/frontend/product/oneProduct(productNo=${productDTO.productNoList.get(0)})}"
                                                   th:text="${productDTO.productName}"></a>
                                            </h6>
                                            <div class="product-price"
                                                 th:each="productPrice : ${productDTO.productPriceSet}">
                                                <span class="text-primary" th:text="'$' + ${productPrice}"></span>
                                            </div>
                                            <div class="nav-thumbs">
                                                <th:block th:each="productSize : ${productDTO.productSizeSet}">
                                                    <div class="form-check radio-text form-check-inline">
                                                        <input class="form-check-input" type="radio" name="size3"
                                                               id="btnradio1"
                                                               th:id="'btnradio1' + ${iterStat.index}">
                                                        <label class="radio-text-label"
                                                               th:for="'btnradio1' + ${iterStat.index}"
                                                               th:text="${sizes[productSize]}"></label>
                                                    </div>
                                                </th:block>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- End Product Box -->
                            <!-- 頁碼 -->
                            <!-- 分頁控件 -->
                            <div class="shop-bottom-bar d-flex align-items-center mt-3">
                                <div th:text="'Showing: ' + ${currentPage * 15 + 1} + ' - ' + (${currentPage + 1} * 15 > ${productPage.totalElements} ? ${productPage.totalElements} : (${currentPage + 1} * 15)) + ' of ' + ${productPage.totalElements}"></div>
                                <div class="ms-auto">
                                    <ul class="pagination">
                                        <li class="page-item"
                                            th:classappend="${productPage.hasPrevious()} ? '' : 'disabled'">
                                            <a class="page-link"
                                               th:href="@{/frontend/product/visitProduct(page=${currentPage - 1}, pageSize=15)}"
                                               aria-label="Previous">
                                                <span aria-hidden="true">«</span>
                                            </a>
                                        </li>
                                        <li class="page-item"
                                            th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}"
                                            th:classappend="${i == currentPage} ? 'active' : ''">
                                            <a class="page-link"
                                               th:href="@{/frontend/product/visitProduct(page=${i}, pageSize=15)}"
                                               th:text="${i + 1}"></a>
                                        </li>
                                        <li class="page-item" th:classappend="${productPage.hasNext()} ? '' : 'disabled'">
                                            <a class="page-link"
                                               th:href="@{/frontend/product/visitProduct(page=${currentPage + 1}, pageSize=15)}"
                                               aria-label="Next">
                                                <span aria-hidden="true">»</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Product Box -->
                </div>
            </div>
        </section>
        <!-- End Shop -->
    </main>
    <!-- End Main -->
    <!-- Footer -->
    <footer th:replace="frontend/component/footer :: footer"></footer>
    <!-- End Footer -->
</div>
<!--
========================
   End Wrapper
========================
-->
<!-- script start -->
<th:block th:insert="~{frontend/component/plugin/frontendplugin.html :: js}"></th:block>
<!-- End script start -->
<script>
    // 購物車
    function testAddToCart(event) {
        event.preventDefault();
        var button = event.target.closest('a'); // 找到最接近的<a>元素
        var row = button.closest('.addToCartBtn'); // 找到最近的包含该按钮的商品项
        var productNo = row.querySelector('input[name="productNo"]').value;
        var productBuyQty = row.querySelector('input[name="productBuyQty"]').value;

        var data = {
            productNo: productNo,
            productBuyQty: productBuyQty
        };

        $.ajax({
            type: 'POST',
            url: "/frontend/cart/addproducttocart",
            data: data,
            success: function(response) {
                console.log("Update successful");
            },
            error: function(error) {
                console.log("Error:", error);
            }
        });
    }

    function testAddToFAV(event) {
        event.preventDefault();
        var button = event.target.closest('a');
        var row = button.closest('.productitm');
        var productNo = row.querySelector('input[name="productNo"]').value;
        var data = {
            productNo: productNo,
        };

        $.ajax({
            type: 'POST',
            url: "/frontend/productmyfavorite/addProductTomyFAV",
            data: data,
            success: function(data) {
                console.log("加入成功");
            }
        });
    }

    function applyFilters() {
        const filters = {};

        // Collect checked filter checkboxes
        document.querySelectorAll('.filter-checkbox:checked').forEach(checkedBox => {
            const filter = checkedBox.dataset.filter;
            const value = checkedBox.dataset.value;
            if (!filters[filter]) {
                filters[filter] = [];
            }
            filters[filter].push(value);
        });

        // Collect min and max price inputs
        const minPriceElement = document.getElementById('minPrice');
        const maxPriceElement = document.getElementById('maxPrice');

        if (minPriceElement && maxPriceElement) {
            const minPrice = minPriceElement.value;
            const maxPrice = maxPriceElement.value;

            if (minPrice && maxPrice) {
                filters['priceRange'] = [`${minPrice}-${maxPrice}`];
            }
        } else {
            console.error('Price input elements not found');
        }

        // Construct URLSearchParams from filters object
        const params = new URLSearchParams();
        for (const key in filters) {
            params.append(key, filters[key].join(','));
        }

        // Send AJAX request to update product list
        const productContainer = document.querySelector('#product-container');
        productContainer.innerHTML = '';

        axios.get(`/frontend/product/filterProducts?${params.toString()}`)
            .then(response => {
                productContainer.innerHTML = response.data;
            })
            .catch(error => console.log('error', error));
    }

    window.onload = function() {
        // Attach event listeners to filter checkboxes
        document.querySelectorAll('.filter-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', applyFilters);
        });

        // Attach event listeners to min and max price inputs
        document.querySelectorAll('#minPrice, #maxPrice').forEach(input => {
            input.addEventListener('change', applyFilters);
        });

        // Attach event listeners to sort buttons
        document.querySelectorAll('.sort-button').forEach(button => {
            button.addEventListener('click', function() {
                const sortType = this.dataset.sort;
                const productContainer = document.querySelector('#product-container');

                productContainer.innerHTML = '';

                axios.get(`/frontend/product/visitProduct-fragment?sortType=${sortType}`)
                    .then(response => {
                        productContainer.innerHTML = response.data;
                    })
                    .catch(error => console.log('error', error));
            });
        });

        // Attach event listeners to add to cart buttons
        var addToCartButtons = document.querySelectorAll(".addToCartBtn .btn-primary");
        addToCartButtons.forEach(function(button) {
            button.addEventListener("click", testAddToCart);
        });

        // Attach event listeners to add to favorite buttons
        var addToFAVBtns = document.querySelectorAll(".addToFAVBtn a");
        addToFAVBtns.forEach(function(button) {
            button.addEventListener("click", testAddToFAV);
        });
    };
</script>

</body>

</html>