<!DOCTYPE html>
<html lang="en" data-bs-theme="light" xmlns:th="http://www.thymeleaf.org">

<head><!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="pxdraft">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template">
    <meta name="description" content="ShopApp - eCommerce Bootstrap 5 Template">
    <!-- title -->
    <title>ShopApp - eCommerce Bootstrap 5 Template</title>
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/logo/favicon.ico}">
    <!-- CSS Template -->
    <link th:href="@{/frontend/assets/css/style.css}" rel="stylesheet">
    <style>
        #preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            /*border: 1px solid #ccc;*/
            /*padding: 5px;*/
        }
    </style>
</head>

<body>
<!-- 通用插件 -->
<th:block th:replace="frontend/component/plugin/frontendplugin :: components"></th:block>
<!-- 通用插件 -->
    <!--
    ========================
        Wrapper
    ========================
    -->
    <div class="wrapper">
        <!-- header height -->
        <div class="header-height-bar" style="min-height: 104.865px;"></div>
        <!-- Header -->
        <header th:replace="frontend/component/header :: header"></header>
        <!-- End Header -->
        <!-- Main -->
        <main>
            <!-- Breadcrumb -->
            <div class="py-3 bg-gray-100">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-6 my-2">
                            <h1 class="m-0 h4 text-center text-lg-start">Profile</h1>
                        </div>
                        <div class="col-lg-6 my-2">
                            <ol class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
                                <li class="breadcrumb-item"><a class="text-nowrap" th:href="@{/}"><i
                                            class="bi bi-home"></i>Home</a></li>
                                <li class="breadcrumb-item text-nowrap active" aria-current="page">Profile</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div><!-- End Breadcrumb --><!-- Table -->
            <div class="py-6">
                <div class="container">
                    <div class="row">
                        <th:block th:insert="~{frontend/member/component/profile-menu.html}"></th:block><!-- Profile Menu -->
                        <div class="col-lg-8 col-xxl-9">
                            <div class="card mb-5">
                                <div class="card-header py-3">
                                    <div>
                                        <h5 class="m-0" style="display: flex; align-items: center; position: relative;">
                                            Profile Update (想單獨修改可以點擊表格中的資料)
                                            <a class="nav-link-style d-flex align-items-center p-3"
                                               th:href="@{/frontend/clicklike/memberClikeLikeData}"
                                               style="display: inline-block; transform: scale(0.8); position: absolute; right: 0;">
                                                <i class="bi bi-search-heart"></i>
                                            </a>
                                            <a class="nav-link-style d-flex align-items-center p-3"
                                               th:href="@{/frontend/articlecollection/memberArticleCollectionData}"
                                               style="display: inline-block; transform: scale(0.8); position: absolute; right: 14px;">
                                                <i class="bi bi-clipboard2-heart me-2"></i>
                                            </a>
                                        </h5>
                                        <div th:if="${param.updatesuccess != null}" style="text-align: center; margin-top: 10px; color: green; display: inline;">
                                            <span th:text="${param.updatesuccess}" style="font-weight: bold;"></span>
                                        </div>
                                        <div th:if="${param.updatesuccessMail != null}" style="text-align: center; margin-top: 10px; color: green; display: inline;">
                                            <span th:text="${param.updatesuccessMail}" style="font-weight: bold;"></span>
                                            <span style="font-weight: bold; color: red">，因為信箱已經重新設定，請重新驗證</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
<!--                                    <form method="post" th:action="@{/frontend/member/newPicture}" enctype="multipart/form-data" onsubmit="return handleAvatarUpload(event)" class="row g-3 align-items-center">-->
<!--&lt;!&ndash;                                        <label for="avatarInput" class="col-auto col-form-label" style="display: none">Change Profile Photo</label>&ndash;&gt;-->
<!--                                        <label for="avatarInput" class="col-auto col-form-label" style="display: none"></label>-->
<!--                                        <div class="col-auto" style="display: none">-->
<!--                                            <input type="file" name="chaPic" class="form-control" id="avatarInput" accept="image/*">-->
<!--                                        </div>-->
<!--                                        <div class="col-auto">-->
<!--                                            <input type="submit" value="上傳新圖片" class="form-control btn btn-primary" style="font-size: 0.8em; padding: 5px 10px;">-->
<!--                                        </div>-->
<!--                                    </form>-->

                                    <!-- 第二個表單，用於預覽和手動提交 -->
<!--                                    <form id="previewForm" class="row g-3 align-items-center">-->
<!--                                        <label for="previewImage" class="col-auto col-form-label" style="display: none"></label>-->
<!--                                        <div class="col-auto" style="display: none">-->
<!--                                            <input type="file" id="previewImage" name="chaPic" class="form-control" accept="image/*">-->
<!--                                        </div>-->
<!--                                        <div class="col-auto" id="previewContainer">-->
<!--                                            &lt;!&ndash; 預覽圖片將在此顯示 &ndash;&gt;-->
<!--                                        </div>-->
<!--                                        <div class="col-auto">-->
<!--                                            <input type="submit" value="上傳新圖片" class="form-control btn btn-primary">-->
<!--                                        </div>-->
<!--                                    </form>-->
<!--                                    <form method="post" th:action="@{newPicture}" enctype="multipart/form-data" onsubmit="return handleAvatarUpload(event)" class="row g-3 align-items-center">-->
<!--                                        <label for="avatarInput" class="col-auto col-form-label" style="display: none"></label>-->
<!--                                        <div class="col-auto">-->
<!--                                            <input type="file" name="chaPic" class="form-control" id="avatarInput" accept="image/*" style="display: none">-->
<!--                                        </div>-->
<!--                                        <div class="col-auto">-->
<!--                                            <input type="submit" value="上傳新圖片" class="form-control btn btn-primary">-->
<!--                                        </div>-->
<!--                                    </form>-->
                                    <div id="preview"></div>
                                    <div class="row">
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Name
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberName}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemName()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Account
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberAccount}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemAcc()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Password
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newPassword}">
                                                <input type="button" class="form-control" value="**************" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Phone
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberMobile}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemMob()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3">
                                            <label class="form-label">
                                                Gender
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control" th:if="${session.loginsuccess.getMemGender() == 1}" value="男性" readonly style="color: black;">
                                            <input type="text" class="form-control" th:if="${session.loginsuccess.getMemGender() == 2}" value="女性" readonly style="color: black;">
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Email
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberMail}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemMail()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Birthday
                                            <span class="text-danger">*</span>
                                        </label>
                                            <input type="text" class="form-control" th:value="${session.loginsuccess.getMemBd()}" readonly style="color: black;">
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Address
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberAddress}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemAdd()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3"><label class="form-label">
                                            Credit card
                                            <span class="text-danger">*</span>
                                        </label>
                                            <a th:href="@{newMemberCreditCard}">
                                                <input type="button" class="form-control" th:value="${session.loginsuccess.getMemCard()}" readonly style="text-align: left; color: black;" onmouseover="this.style.color='red';" onmouseout="this.style.color='black';">
                                            </a>
                                        </div>
                                        <div class="col-sm-6 mb-3">
                                            <label class="form-label" th:if="${session.loginsuccess.getMemStat() == 0}">
                                                驗證狀態
                                                <span class="text-danger">*</span>
                                            </label>
                                            <label class="form-label" th:if="${session.loginsuccess.getMemStat() == 1}">
                                                驗證狀態
                                                <span class="text-bg-light">*</span>
                                            </label>
                                            <a th:href="@{varifyMailByOneMember}">
                                                <input type="button" class="form-control" th:if="${session.loginsuccess.getMemStat() == 0 && session.loginsuccess.getProvider() == null}" value="尚未驗證，點擊進行驗證，以便建立第三方服務" style="text-align: left; color: red;" onmouseover="this.style.color='pink';" onmouseout="this.style.color='red';">
                                                <input type="button" class="form-control" th:if="${session.loginsuccess.getMemStat() == 0 && session.loginsuccess.getProvider() != null}" value="尚未驗證，點擊進行驗證" style="text-align: left; color: red;" onmouseover="this.style.color='pink';" onmouseout="this.style.color='red';">
                                            </a>
                                            <input type="text" class="form-control" th:if="${session.loginsuccess.getMemStat() == 1}" value="已驗證" readonly style="color: black;">
                                        </div>
                                        <div class="col-sm-6 mb-3">
                                            <form method="get" th:action="@{updateData}">
                                                <input type="hidden" name="memNo" th:value="${myData.memNo}" readonly style="display: none;">
                                                <div class="col-12 pt-2">
                                                    <button type="submit" class="btn btn-primary">前往修改會員資料</button>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="col-sm-6 mb-3">
                                            <label class="form-label" th:if="${session.loginsuccess.getMemStat() == 1 && session.loginsuccess.getProvider() == null}">
                                                尚未有第三方連結，選擇以下進行連結，建立快速登入
                                                <span class="text-danger">*</span>
                                            </label>
                                            <label class="form-label" th:if="${session.loginsuccess.getProvider() != null}">
                                                已經建立的第三方連結
                                                <span class="text-danger">*</span>
                                            </label>
                                            <input type="text" class="form-control" th:if="${session.loginsuccess.getProvider() == 0}" value="Line" readonly style="color: black;">
                                            <input type="text" class="form-control" th:if="${session.loginsuccess.getProvider() == 1}" value="Google" readonly style="color: black;">
                                            <div>
                                                <form id="buildAuthUrlForm" th:action="@{/google/buildAuthUrlByAlreadyLogin}"  spellcheck="false" th:if="${session.loginsuccess.getMemStat() == 1 && session.loginsuccess.getProvider() == null}">
                                                    <div class="col">
                                                        <button class="btn w-100 btn-mode" type="submit" ><i
                                                                class="bi bi-google me-2"></i> Google
                                                        </button>
                                                    </div>
                                                </form>
                                                <form id="exchangeTokenForm" method="post" th:action="@{/google/exchangeTokenByAlreadyLogin}" spellcheck="false">
                                                    <div>
                                                        <label style="vertical-align: top;"></label>
                                                        <textarea id="code" name="code" rows="3" cols="60" type="text"></textarea>
                                                    </div>
                                                    <div>
                                                        <button type="submit" id="content"></button>
                                                    </div>
                                                </form>
                                                <div>
                                                    <p id="exchangeTokenForm-outputStatus"></p>
                                                    <p id="exchangeTokenForm-output" class="output-json"></p>
                                                </div>
                                                <div class="api-form">
                                                <form id="getGoogleUserForm" th:action="@{/google/getGoogleUserByAlreadyLogin}" spellcheck="false" name="accessToken">
                                                    <p style="font-weight: 700">
                                                    <div>
                                                        <label style="vertical-align: top;"></label>
                                                        <textarea id="getGoogleUserForm-accessToken" rows="6" cols="60" type="text"></textarea>
                                                    </div>
                                                    <button type="submit" id="getUserForm"></button>
                                                </form>
                                                <div>
                                                    <!--                                                <p>返回結果：</p>-->
                                                    <p id="getGoogleUserForm-outputStatus"></p>
                                                    <p id="getGoogleUserForm-output" class="output-json">.</p>
                                                </div>
                                        </div>

<!--                                        <form method="get" th:action="@{updateData}">-->
<!--                                            <input type="hidden" name="memNo" th:value="${myData.memNo}" readonly style="display: none;">-->
<!--                                            <div class="col-12 pt-2">-->
<!--                                                <button type="submit" class="btn btn-primary">前往修改會員資料</button>-->
<!--                                            </div>-->
<!--                                        </form>-->
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Content -->
                    </div>
                </div>
            </div>
        </main>
        <!-- End Main -->
        <!-- Footer -->
        <footer th:replace="frontend/component/footer :: footer"></footer>
        <!-- End Footer -->
    </div>
    <!--
    ========================
       End Wrapper
    ========================
    -->
    <!-- script start -->
    <th:block th:insert="~{frontend/component/plugin/frontendplugin.html :: js}"></th:block>
    <!-- End script start -->
<!--    <script>-->

<!--        let choose_file_el = document.getElementById("choose_file");-->
<!--        choose_file_el.addEventListener("click", function () {-->
<!--            let my_input = document.getElementById("the_file");-->
<!--            my_input.click(); //input type=flie 被點-->
<!--        });-->
<!--        window.addEventListener("load", function () {-->
<!--            var the_file_element = document.getElementById("the_file");-->
<!--            the_file_element.addEventListener("change", function (e) {-->
<!--                let that = this;-->
<!--                let ul_el = document.querySelector(".picture_list");-->
<!--                ul_el.innerHTML = "";-->

<!--                for (let i = 0; i < this.files.length; i++) {-->
<!--                    let reader = new FileReader();-->
<!--                    reader.readAsDataURL(this.files[i]);-->
<!--                    reader.addEventListener("load", function () {-->
<!--                        let li_html2 = `<li>-->

<!--                                                <input type="submit" class="submit" value="儲存">-->
<!--                                        </li>`;-->

<!--                        let html_img = document.getElementById("pic");-->
<!--                        let html_newImg = document.createElement("img");-->
<!--                        html_newImg.src = `${this.result}`;-->
<!--                        html_newImg.id = "changeImg";-->
<!--                        html_newImg.style = "width: 100%; height: 100%";-->
<!--                        let html_oldImg = document.getElementById("memImg");-->
<!--                        if (html_oldImg === null) {-->
<!--                            html_oldImg = document.getElementById("changeImg")-->
<!--                        }-->
<!--                        console.log(html_oldImg);-->

<!--                        html_img.replaceChild(html_newImg, html_oldImg);-->

<!--                        ul_el.insertAdjacentHTML("beforeend", li_html2);-->
<!--                    });-->
<!--                }-->
<!--            });-->
<!--        });-->

<!--        // 處理表單提交並使用 AJAX 上傳新圖片-->
<!--        function handleAvatarUpload(event) {-->
<!--            event.preventDefault(); // 阻止默認提交行為-->

<!--            // 使用 FormData 收集表單數據-->
<!--            const formData = new FormData(event.target);-->

<!--            // 使用 fetch 發送 POST 請求-->
<!--            fetch('/frontend/member/newPicture', {-->
<!--                method: 'POST',-->
<!--                body: formData-->
<!--            })-->
<!--                .then(response => response.json()) // 將回應解析為 JSON 格式-->
<!--                .then(data => {-->
<!--                    if (data.success) {-->
<!--                        // 上傳成功：更新頁面上的大頭貼圖片-->
<!--                        const avatarElement = document.getElementById('memberAvatar');-->
<!--                        avatarElement.src = data.newAvatarUrl; // 更新圖片的 src 屬性-->

<!--                        // 顯示成功消息-->
<!--                        alert('上傳成功！');-->

<!--                        // 在上傳成功後進行重定向-->
<!--                        window.location.href = '/frontend/member/memberData';-->
<!--                    } else {-->
<!--                        // 上傳失敗：顯示錯誤消息-->
<!--                        console.error('上傳失敗:', data.error);-->
<!--                        alert('上傳失敗，請重試。');-->
<!--                    }-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    // 請求過程中的錯誤處理-->
<!--                    console.error('錯誤:', error);-->
<!--                    alert('發生錯誤，請稍後重試。');-->
<!--                });-->
<!--        }-->
<!--    </script>-->
    <script>
        $(".camera-icon").click(function(){
            $("#avatarInput").click();
        })

        // 當用戶選擇圖片後，將其顯示在第二個表單中
        document.getElementById('avatarInput').addEventListener('change', function(event) {
            const file = event.target.files[0]; // 獲取所選文件

            const previewImage = document.getElementById('previewImage'); // 第二個表單中的預覽圖片元素
            const previewFormInput = document.getElementById('previewFormInput'); // 第二個表單中的用於上傳的 input 元素

            // 如果想要在第二個表單中預覽圖片，可以將圖片顯示在預覽圖片元素中
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });
    </script>

<!--    <script>-->
<!--        document.getElementById('avatarInput').addEventListener('change', function(event) {-->
<!--            // 獲取所選文件-->
<!--            const file = event.target.files[0];-->

<!--            // 手動觸發原本的表單提交，將選擇的文件一起提交到伺服器-->
<!--            document.querySelector('form.row').submit();-->
<!--        });-->
<!--    </script>-->

<!--<script>-->
<!--    // 選擇圖片後的處理函數-->
<!--    document.getElementById('avatarInput').addEventListener('change', function(event) {-->
<!--        const file = event.target.files[0];-->
<!--        const reader = new FileReader();-->

<!--        reader.onload = function(e) {-->
<!--            const previewContainer = document.getElementById('previewContainer');-->
<!--            previewContainer.innerHTML = ''; // 清空容器-->
<!--            const img = document.createElement('img');-->
<!--            img.src = e.target.result;-->
<!--            img.style.width = '100px'; // 設置圖片寬度-->
<!--            img.style.height = '100px'; // 設置圖片高度-->
<!--            previewContainer.appendChild(img); // 將圖片添加到預覽容器-->
<!--        };-->

<!--        reader.readAsDataURL(file); // 讀取文件並顯示預覽-->
<!--    });-->

<!--    // 手動提交預覽表單-->
<!--    document.getElementById('previewForm').addEventListener('submit', function(event) {-->
<!--        event.preventDefault(); // 阻止默認提交行為-->

<!--        // 使用 FormData 收集表單數據-->
<!--        const formData = new FormData(event.target);-->

<!--        // 使用 fetch 發送 POST 請求-->
<!--        fetch('/frontend/member/newPicture', {-->
<!--            method: 'POST',-->
<!--            body: formData-->
<!--        })-->
<!--            .then(response => response.json()) // 將回應解析為 JSON 格式-->
<!--            .then(data => {-->
<!--                if (data.success) {-->
<!--                    alert('上傳成功！');-->
<!--                    window.location.href = '/frontend/member/memberData';-->
<!--                } else {-->
<!--                    console.error('上傳失敗:', data.error);-->
<!--                    alert('上傳失敗，請重試。');-->
<!--                }-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error('錯誤:', error);-->
<!--                alert('發生錯誤，請稍後重試。');-->
<!--            });-->
<!--    });-->
<!--</script>-->
    <script>
        document.getElementById('avatarInput').addEventListener('change', function() {
            var preview = document.getElementById('preview');
            var file = this.files[0];
            var reader = new FileReader();

            reader.onload = function() {
                var img = new Image();
                img.src = reader.result;
                img.style.maxWidth = '100%';
                img.style.maxHeight = '100%';
                preview.innerHTML = '';
                preview.appendChild(img);
            }

            if (file) {
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = 'No image selected';
            }
        });
    </script>
    <script>
        document.getElementById("buildAuthUrlForm").addEventListener("submit", (event) => {
            event.preventDefault();

            // 指定 http method、url
            const http = new XMLHttpRequest();
            const method = "GET";
            const url = "http://localhost:8080/google/buildAuthUrlByAlreadyLogin";
            http.open(method, url);

            // 發出 http request 請求
            http.send();

            http.onreadystatechange = (e) => {
                var a = document.getElementById("buildAuthUrlForm-a");
                a.setAttribute("href", http.responseText);
            }
        });

        document.getElementById("exchangeTokenForm").addEventListener("submit", (event) => {
            event.preventDefault();

            // 指定 http method、url
            const http = new XMLHttpRequest();
            const method = "POST";
            const url = "http://localhost:8080/google/exchangeTokenByAlreadyLogin";
            http.open(method, url);

            // 添加 request body 中的參數
            var data = {
                "code": document.getElementById("code").value
            }

            // 發出 http request 請求
            http.setRequestHeader("Content-Type", "application/json");
            http.send(JSON.stringify(data));

            http.onreadystatechange = (e) => {
                var outputStatus = document.getElementById("exchangeTokenForm-outputStatus");
                var output = document.getElementById("exchangeTokenForm-output");
                showOutput(http, outputStatus, output);
            }
        });

        document.getElementById("getGoogleUserForm").addEventListener("submit", (event) => {
            event.preventDefault();

            // 指定 http method、url
            const http = new XMLHttpRequest();
            const method = "POST";
            // const url = "https://www.googleapis.com/oauth2/v2/userinfo";
            const url = "http://localhost:8080/google/getGoogleUserByAlreadyLogin";
            http.open(method, url);

            // 添加 acces token 的值在 Authorization header 中
            const accessToken = document.getElementById("getGoogleUserForm-accessToken").value;
            http.setRequestHeader("Authorization", "Bearer " + accessToken);

            // 發出 http request 請求
            http.setRequestHeader("Content-Type", "application/json");
            http.send(JSON.stringify(accessToken));
            // http.send();

            http.onreadystatechange = (e) => {
                var outputStatus = document.getElementById("getGoogleUserForm-outputStatus");
                var output = document.getElementById("getGoogleUserForm-output");
                showOutput(http, outputStatus, output);
            }
        });

        document.getElementById("refreshTokenForm").addEventListener("submit", (event) => {
            event.preventDefault();

            // 指定 http method、url
            const http = new XMLHttpRequest();
            const method = "POST";
            const url = "http://localhost:8080/google/refreshTokenByAlreadyLogin";
            http.open(method, url);

            // 添加 request body 中的參數
            var data = {
                "refreshToken": document.getElementById("refreshToken").value
            }

            // 發出 http request 請求
            http.setRequestHeader("Content-Type", "application/json");
            http.send(JSON.stringify(data));

            http.onreadystatechange = (e) => {
                var outputStatus = document.getElementById("refreshTokenForm-outputStatus");
                var output = document.getElementById("refreshTokenForm-output");
                showOutput(http, outputStatus, output);
            }
        });

        function showOutput(http, outputStatus, output) {
            outputStatus.style.backgroundColor = "#D0D0D0";
            outputStatus.innerHTML = http.status;

            output.style.backgroundColor = "#D0D0D0";
            try {
                output.innerHTML = JSON.stringify(JSON.parse(http.responseText), null, 4);
            } catch (e) {
                output.innerHTML = http.responseText;
            }
        }

    </script>
    <script>
        document.getElementById("buildAuthUrlForm").addEventListener("submit", (event) => {
            event.preventDefault();

            // 指定 http method、url
            const http = new XMLHttpRequest();
            const method = "GET";
            const url = "http://localhost:8080/google/buildAuthUrlByAlreadyLogin";
            http.open(method, url);

            // 發出 http request 請求
            http.send();

            http.onreadystatechange = (e) => {
                if (http.readyState === 4 && http.status === 200) {
                    // 獲取返回結果
                    var returnUrl = http.responseText;
                    // 跳轉到 Google 驗證頁面
                    window.location.href = returnUrl;
                }
            };
        });
    </script>
    <script>
        // 解析 URL 中的 code 值
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');

        // 如果 URL 中包含 code 參數且表單存在
        if (code != null) {
            // 將 code 值填入表單的 textarea 中
            document.getElementById("code").value = code;

            console.log("輸入框有值，自動提交表單");

            // 自動提交表單
            document.getElementById("content").click();

            // 彈出成功消息
            alert("建立第三方連結成功");
        }
    </script>
    <script>
        // 獲取包含 JSON 資料的元素
        var exchangeTokenFormOutput = document.getElementById("exchangeTokenForm-output");

        // 解析 JSON 格式資料
        var tokenData = JSON.parse(exchangeTokenFormOutput.textContent);

        // 獲取 access_token
        var accessToken = tokenData.access_token;

        // 現在你可以使用 accessToken 進行後續操作
        console.log("Access Token:", accessToken);

        // 將 access_token 填入相應的 textarea 中
        document.getElementById("getGoogleUserForm-accessToken").value = accessToken;

        // 提交表單
        document.getElementById("getUserForm").click();


        // 發送 AJAX 請求到購物主頁
        const http = new XMLHttpRequest();
        const method = "GET";
        const url = "/frontend/member/memberData"; // 個人主頁的 URL
        http.open(method, url);
        http.send();

        http.onreadystatechange = (e) => {
            // 如果請求成功，跳轉到個人主頁
            if (http.readyState === 4 && http.status === 200) {
                window.location.href = url;
            }
        };
    </script>

<style>
    .title a {
        font-size: 18px;
        text-decoration: none;
    }

    .title span {
        background-color: #EA4335;
        color: #FFFFFF;
        border-radius: 5px;
        padding: 1px 8px 1px 8px;
    }

    .connect-button {
        background-color: #EA4335;
        color: #FFFFFF;
        width: fit-content;
        border-radius: 5px;
        padding: 3px 8px 3px 8px;
        margin: 0 0 20px 0;
    }

    .api-form {
        display: inline-block;
        padding: 0 20px 0 20px;
        margin: 0 0 20px 0;
        border: 1px solid #000000;

        button {
            display: block;
            margin-block-start: 1em;
            margin-block-end: 1em;
        }
    }

    .output-json {
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    a.show-url {
        &::after {
            content: attr(href);
        }
    }

    ul {
        padding-inline-start: 20px;
    }

    li {
        padding: 5px 0 5px 0;
    }

    body {
        margin: 0 20px 50px 20px;
    }

    #code {
        display: none; /* 隱藏代碼輸入框 */
    }

    #exchangeTokenForm button[type="submit"] {
        display: none; /* 隱藏送出按鈕 */
    }

    /* 隱藏 exchangeTokenForm-outputStatus 元素 */
    #exchangeTokenForm-outputStatus,
        /* 隱藏 exchangeTokenForm-output 元素 */
    #exchangeTokenForm-output,
        /* 隱藏 getGoogleUserForm-outputStatus 元素 */
    #getGoogleUserForm-outputStatus,
        /* 隱藏 getGoogleUserForm-output 元素 */
    #getGoogleUserForm-output,
        /* 隱藏 getUserForm 元素 */
    #getUserForm,
        /* 隱藏 getGoogleUserForm-accessToken 元素 */
    #getGoogleUserForm-accessToken,
        /* 隱藏 getGoogleUserForm-output 元素的外框 */
    .api-form {
        display: none; /* 設置 display 屬性為 none，隱藏元素 */
    }


</style>

</body>

</html>