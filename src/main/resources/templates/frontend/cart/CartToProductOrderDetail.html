<html lang="zxx" data-bs-theme="light" xmlns="http://www.w3.org/1999/html">

<head><!-- metas -->
    <meta charset="utf-8">
    <meta name="author" content="pxdraft">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
    <meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template">
    <meta name="description" content="ShopApp - eCommerce Bootstrap 5 Template">
    <!-- title -->
    <title>ShopApp - eCommerce Bootstrap 5 Template</title>
    <!-- Favicon -->
    <link rel="shortcut icon" th:href="@{/logo/favicon.ico}">
    <!-- CSS Template -->
    <link th:href="@{/frontend/assets/css/style.css}" rel="stylesheet">
    <style>
        .coupon {
            padding: 20px;
            background-color: #fff;
            border: 2px dashed #f69314;
            border-radius: 10px;
            font-size: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .coupon:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .coupon strong {
            font-size: 24px;
            color: #f69314;
            margin-top: 10px;
            display: block;
        }

        .coupon p {
            margin: 0;
            color: #333;
        }

        /* Custom styles for the coupon */
        .left, .right {
            background-color: #f69314;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-block;
            transform: rotate(-90deg);
        }

        .right {
            transform: rotate(90deg);
        }

        .center {
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-block;
            margin: 0 10px;
        }

        /* Input style */
        input[type=text] {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
            margin-top: 20px;
            width: 300px;
        }

        input[type=submit] {
            padding: 10px 20px;
            background-color: #f69314;
            color: #fff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>

<body>
<!-- 通用插件 -->
<th:block th:replace="frontend/component/plugin/frontendplugin :: components"></th:block>
<!-- 通用插件 -->
<!--
    ========================
        Wrapper
    ========================
    -->
<div class="wrapper">
    <!-- heder height -->
    <div class="header-height-bar" style="min-height: 104.865px;"></div>
    <!-- Header -->
    <!-- Header -->
    <header th:replace="frontend/component/header :: header"></header>
    <!-- End Header -->
    <!-- Main -->
    <main>
        <!-- Page Title -->
        <div class="bg-no-repeat bg-cover bg-right-center position-relative"
             style="background-image: url(../../assets/img/fashion2/home-banner-3.jpg);">
            <div class="position-absolute top-0 end-0 start-0 bottom-0 opacity-3 bg-dark"></div>
            <!-- Header Height Bar -->
            <div class="header-height-bar border-bottom opacity-3" style="min-height: 104.865px;"></div>
            <div class="container py-6 position-relative">
                <div class="row align-items-center">
                    <div class="col-lg-6 my-2">
                        <h1 class="m-0 h4 text-center text-lg-start text-white">Your cart</h1>
                    </div>
                    <div class="col-lg-6 my-2">
                        <ol
                                class="breadcrumb breadcrumb-light m-0 small justify-content-center justify-content-lg-end">
                            <li class="breadcrumb-item"><a class="text-nowrap" href="#">Home</a></li>
                            <li class="breadcrumb-item text-nowrap active" aria-current="page">Your cart</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div><!-- End Page Title --><!-- Section -->
        <section class="section">
            <div class="container">
                <div class="row align-items-start">
                    <div class="col-md-7"><!-- Form -->
                        <form th:action="@{/frontend/productorder/insertProductOrderSuccess}" method="post"
                              onsubmit="return dosubmit();">
                            <h6 class="mb-4 h3">寄送資訊</h6>
                            <tbody>


                            <div>
                                <label>訂購人姓名: <span class="required">*</span>
                                </label>
                                <input class="form-control" type="text" th:name="productByrName" th:id="productByrName"
                                       th:field="*{productOrder.member.memName}">
                                <span id="productByrName-error" class="error-message"></span>
                            </div>
                            <div>
                                <label>訂購人手機號碼:<span class="required">*</span>
                                </label>
                                <input class="form-control" type="text" th:name="productByrPhone"
                                       th:id="productByrPhone"
                                       th:field="*{productOrder.member.memMob}">
                                <span id="productByrPhone-error" class="error-message"></span>
                            </div>
                            <div>
                                <label>訂購人Email:<span class="required">*</span>
                                </label>
                                <input class="form-control" type="email" th:name="productByrEmail"
                                       th:id="productByrEmail"
                                       placeholder="請輸入電子信箱" th:field="*{productOrder.member.memMail}">
                                <span id="productByrEmail-error" class="error-message"></span>
                            </div>
                            <div>
                                <input type="checkbox" id="copyInfo" onclick="copyBuyerInfo(this)">
                                <label for="copyInfo">同訂購人</label>
                            </div>
                            <div>
                                <label>收件人姓名: <span class="unrequired"></span>
                                </label>
                                <input class="form-control" type="text" th:name="productRcvName" th:id="productRcvName"
                                       th:field="*{productOrder.productRcvName}">
                                <span id="productRcvName-error" class="error-message"></span>

                                <div>
                                    <label>收件人手機號碼:<span class="unrequired"></span>
                                    </label>
                                    <input class="form-control" type="text" th:name="productByrPhone"
                                           th:id="productRcvPhone"
                                           th:field="*{productOrder.productRcvPhone}">
                                    <span id="productRcvPhone-error" class="error-message"></span>
                                </div>

                                <label>取貨方式:</label>
                                <select class="form-control" th:field="*{productOrder.productTakeMethod}">
                                    <option th:value="1" th:text="店取"/>
                                    <option th:value="2" th:text="宅配"/>
                                    <option th:value="3" th:text="超商取貨"/>
                                </select><br/>
                            </div>

                            <div class="col-md-12">
                                <div class="checkout-form-list">
                                    <label>宅配住址: <span class="unrequired"></span></label>
                                    <input id="productAddr" placeholder="請輸入地址" type="text"
                                           name="productAddr" th:field="*{productOrder.member.memAdd}">
                                    <span id="productAddr-error" class="error-message"></span>
                                </div>
                            </div>
                            <div>
                                <label>付款方式:</label>
                                <select class="form-control" th:field="*{productOrder.productPayMethod}">
                                    <option th:value="1" th:text="線上刷卡"/>
                                    <option th:value="2" th:text="超商繳款"/>
                                    <option th:value="3" th:text="ATM付款"/>
                                    <option th:value="4" th:text="匯款"/>
                                    <option th:value="5" th:text="現場付款"/>
                                </select><br/>
                            </div>
                            <!--                            <div>-->
                            <!--                                <label>訂單總金額:</label>-->
                            <!--                                <input class="form-control" type="text" id="productAllPrice" th:name="productAllPrice" th:value="${productOrder.productAllPrice}" readonly/><br/>-->
                            <!--                                <span th:if="${#fields.hasErrors('productOrder.productAllPrice')}" th:errors="*{productOrder.productAllPrice}" class="error" id="productAllPrice.errors"></span>-->
                            <!--                            </div>-->
                            <!--                            <div>-->
                            <!--                                <label>優惠券編號:</label>-->
                            <!--                                <input class="form-control" type="text" id="coupNo" th:field="*{productOrder.coupon.coupNo}" th:name="coupNo"  th:onchange="|updatePriceInstantly()|" onclick="hideContent('productOrder.coupon.errors');" /><br/>-->
                            <!--                                <span th:if="${#fields.hasErrors('productOrder.coupon')}" th:errors="*{productOrder.coupon}" class="error" id="productOrder.coupon.errors"></span>-->
                            <!--                            </div>-->


                            </tbody>


                                                        <div class="mb-5"><!-- Checkbox -->
                                                            <div class="form-check"><input class="form-check-input"
                                                                                           id="checkout_Shipping_Address" type="checkbox"> <label
                                                                    class="form-check-label" data-bs-toggle="collapse"
                                                                    data-bs-target="#checkout_Shipping_AddressCollapse"
                                                                    for="checkout_Shipping_Address">Ship to a different address?</label></div>
                                                            <!-- Collapse -->
                                                            <div class="collapse" id="checkout_Shipping_AddressCollapse">
                                                                <div class="row gy-4 pt-3">
                                                                    <div class="col-12"><label class="form-label"
                                                                                               for="checkout_Shipping_Address_Country">Country *</label> <input
                                                                            class="form-control" id="checkout_Shipping_Address_Country"
                                                                            type="text" placeholder="Country"></div>
                                                                    <div class="col-12"><label class="form-label"
                                                                                               for="checkout_Shipping_AddressLine_One">Address Line 1 *</label>
                                                                        <input class="form-control" id="checkout_Shipping_AddressLine_One"
                                                                               type="text" placeholder="Address Line 1"></div>
                                                                    <div class="col-12"><label class="form-label"
                                                                                               for="checkout_Shipping_AddressLine_Two">Address Line 2</label>
                                                                        <input class="form-control" id="checkout_Shipping_AddressLine_Two"
                                                                               type="text" placeholder="Address Line 2 (optional)"></div>
                                                                    <div class="col-6"><label class="form-label"
                                                                                              for="checkout_Shipping_Address_Town">Town / City *</label> <input
                                                                            class="form-control" id="checkout_Shipping_Address_Town" type="text"
                                                                            placeholder="Town / City"></div>
                                                                    <div class="col-6"><label class="form-label"
                                                                                              for="checkout_Shipping_Address_ZIP">ZIP / Postcode *</label> <input
                                                                            class="form-control" id="checkout_Shipping_Address_ZIP" type="text"
                                                                            placeholder="ZIP / Postcode"></div>
                                                                    <div class="col-12"><!-- Button --> <button class="btn btn-outline-mode"
                                                                                                                type="submit">Save Address</button></div>
                                                                </div>
                                                            </div>
                                                        </div><!-- Heading -->
                                                        <h6 class="mb-4 h3">Payment</h6><!-- List group -->
                                                        <div class="list-group mb-5 accordion" id="payment-methods">
                                                            <div class="list-group-item py-3"><!-- Radio -->
                                                                <div class="form-check mb-0"><!-- Input --> <input
                                                                        class="form-check-input collapsed" id="checkout_Payment_Card"
                                                                        name="payment" type="radio" data-bs-toggle="collapse"
                                                                        data-bs-action="show"
                                                                        data-bs-target="#checkout_Payment_CardCollapse"><!-- Label --> <label
                                                                        class="form-check-label fw-500 stretched-link"
                                                                        for="checkout_Payment_Card">Credit Card <img class="ml-2"
                                                                                                                     src="../../assets/img/cart/cards.svg" alt="..."></label></div>
                                                            </div>
                                                            <div class="list-group-item py-0 collapse" id="checkout_Payment_CardCollapse"
                                                                 data-bs-parent="#payment-methods"><!-- Form -->
                                                                <div class="row py-4 g-3">
                                                                    <div class="col-12"><input class="form-control"
                                                                                               id="checkout_Payment_CardNumber" type="text"
                                                                                               placeholder="Card Number *" required=""></div>
                                                                    <div class="col-12"><input class="form-control"
                                                                                               id="checkout_Payment_CardName" type="text"
                                                                                               placeholder="Name on Card *" required=""></div>
                                                                    <div class="col-12 col-md-4"><select class="form-select"
                                                                                                         id="checkoutPaymentMonth">
                                                                        <option>January</option>
                                                                        <option>February</option>
                                                                        <option>March</option>
                                                                    </select></div>
                                                                    <div class="col-12 col-md-4"><select class="form-select"
                                                                                                         id="checkout_Payment_CardYear">
                                                                        <option>2017</option>
                                                                        <option>2018</option>
                                                                        <option>2019</option>
                                                                    </select></div>
                                                                    <div class="col-12 col-md-4">
                                                                        <div class="input-group input-group-merge"><input class="form-control"
                                                                                                                          id="checkout_Payment_CardCVV" type="text" placeholder="CVV *"
                                                                                                                          required="">
                                                                            <div class="input-group-append"><span class="input-group-text"
                                                                                                                  data-bs-toggle="tooltip" data-bs-placement="top"
                                                                                                                  aria-label="The CVV Number on your credit card or debit card is a 3 digit number on VISA, MasterCard and Discover branded credit and debit cards."
                                                                                                                  data-bs-original-title="The CVV Number on your credit card or debit card is a 3 digit number on VISA, MasterCard and Discover branded credit and debit cards."><i
                                                                                    class="bi bi-info-circle"></i></span></div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="list-group-item py-3"><!-- Radio -->
                                                                <div class="form-check mb-0"><!-- Input --> <input
                                                                        class="form-check-input collapsed" id="checkout_Payment_Paypal"
                                                                        name="payment" type="radio" data-bs-toggle="collapse"
                                                                        data-bs-action="hide"
                                                                        data-bs-target="#checkout_Payment_PayPalCollapse"><!-- Label --> <label
                                                                        class="form-check-label stretched-link"
                                                                        for="checkout_Payment_Paypal"><img
                                                                        src="../../assets/img/cart/paypal.svg" alt="..."></label></div>
                                                            </div>
                                                            <div class="list-group-item py-0 collapse" id="checkout_Payment_PayPalCollapse"
                                                                 data-bs-parent="#payment-methods">
                                                                <div class="p-3">
                                                                    <p class="mb-0 text-body">By clicking on the button below you will be
                                                                        redirected to your PayPal account to complete the payment.</p>
                                                                </div>
                                                            </div>
                                                        </div><!-- Notes --> <label class="form-label" for="checkout_Billing_First_Name">Order
                                                            Notes (optional)</label> <textarea class="form-control mb-4 mb-md-0 font-size-xs"
                                                                                               rows="5" placeholder="Order Notes"></textarea>

                                                </div>
                            <div class="col-md-5 col-lg-4 offset-lg-1 " style="top: 114.094px;">
                                <h6 class="mb-4 h3">商品訂單明細</h6>
                                <ul class="list-group mb-6">
                                    <!-- 使用th:each内联属性来处理遍历 -->
                                    <li class="list-group-item p-3" th:each="productOrderDetail : ${productOrder.ProductOrderDetails}">
                                        <div class="row g-2">
                                            <div>
                                                <img th:src="'data:image/png;base64,' + ${session['productImage' + productOrderDetail.product.productNo]}"
                                                      alt="Product Picture" style="width: auto; height: 80px;"/>
                                                <span th:text="${productOrderDetail.product.productName}" style="font-size: larger;"></span>
                                            </div>
                                            <div>
                                                &nbsp;&nbsp;&nbsp;規格:<span th:text="${productOrderDetail.product.productColor}"></span>
                                                <span th:if="${productOrderDetail.product.productSize == 0}">XS</span>
                                                <span th:if="${productOrderDetail.product.productSize == 1}">S</span>
                                                <span th:if="${productOrderDetail.product.productSize == 2}">M</span>
                                                <span th:if="${productOrderDetail.product.productSize == 3}">L</span>
                                                <span th:if="${productOrderDetail.product.productSize == 4}">XL</span>
                                                <span th:if="${productOrderDetail.product.productSize == 5}">2L</span>
                                            </div>
                                            <!-- Footer -->
                                            <div class="d-flex align-items-center">
                                                <span>價錢:</span>&nbsp;&nbsp;&nbsp;
                                                <span th:text="'$ ' + ${productOrderDetail.productPrice}"></span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span>數量:</span>&nbsp;&nbsp;&nbsp;
                                                <span th:text="${productOrderDetail.productOrdQty} + ' 個'"></span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <div class="col-sm-3 form-control"><label class="mb-4 h3" for="coupNo">請輸入優惠券編號</label>
                                    <select class="form-control" size="1" name="coupNo" id="coupNo"
                                            onchange="updatePriceInstantly()">
                                        <option value="1">請選擇</option>
                                        <!-- 使用 Thymeleaf 循环来动态生成选项 -->
                                        <option th:each="mycoupon : ${coupons}" th:value="${mycoupon.coupon.coupNo}"
                                                th:text="${mycoupon.coupon.coupNo + ' 號優惠券折數: ' + mycoupon.coupon.coupDisc}">
                                        </option>
                                    </select>

                                </div>
                                <div class="card bg-gray-100">
                                    <div class="card-body py-0 px-4">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item d-flex bg-transparent px-0 py-3">
                                                <span>總價：</span>
                                                <span class="ms-auto" id="productAllPrice"
                                                      th:text="${productOrder.productAllPrice}"
                                                      th:value="${productOrder.productAllPrice}"></span>
                                            </li>
                                            <li class="list-group-item d-flex bg-transparent px-0 py-3">
                                                <span>折價：</span>
                                                <span class="ms-auto" id="productDisc"
                                                      th:text="${productOrder.productDisc}"
                                                      th:value="${productOrder.productDisc}"></span>
                                            </li>
                                            <li class="list-group-item d-flex bg-transparent px-0 py-3 fs-lg fw-600">
                                                <span>實際金額：</span>
                                                <span class="ms-auto" id="productRealPrice"
                                                      th:text="${productOrder.productRealPrice}"
                                                      th:value="${productOrder.productRealPrice}"></span>
                                            </li>
                                        </ul>
                                    </div>

                                    </br>

                                    <div class="pt-4">
                                        <button type="submit" class="btn btn-primary w-100">確定購買</button>
                                        <input type="hidden" name="memNo" th:value="${productOrder.member.memNo}"/>
                                    </div>
                                </div>

                            </div>



                        </form>
                    </div>
                </div>
            </div>
        </section>
        <!-- End Section -->
    </main>

    <!-- End Main -->

    <!-- Footer -->
    <footer th:replace="frontend/component/footer :: footer"></footer>
    <!-- End Footer -->
</div>
<!--
    ========================
       End Wrapper
    ========================
    -->
<!-- script start -->
<th:block th:insert="~{frontend/component/plugin/frontendplugin.html :: js}"></th:block>
<!-- End script start -->
<script th:inline="javascript">
    // 获取选择框元素
    var selectElement = document.querySelector('select[name="productOrder.productTakeMethod"]');

    // 添加事件监听器
    selectElement.addEventListener('change', function () {
        // 获取选择的值
        var selectedValue = parseInt(selectElement.value);

        // 获取地址输入框元素
        var addressInput = document.getElementById("productAddr");
        var addressError = document.getElementById("productAddr-error");

        // 如果选择的是宅配方式（值为2），则将地址字段设为必填项
        if (selectedValue === 2) {
            addressInput.required = true;
            addressError.textContent = "";
        } else {
            addressInput.required = false;
            addressInput.value = ""; // 清空地址输入框的值
            addressError.textContent = "";
        }
    });


    function updatePriceInstantly() {
        var coupNo = document.getElementById('coupNo').value; // 获取优惠券编号的值
        var productDisc = document.getElementById('productDisc').innerText; // 获取产品折扣的值
        var productRealPrice = document.getElementById('productRealPrice').innerText; // 获取产品实际价格的值
        var productAllPrice = document.getElementById('productAllPrice').innerText; // 获取产品总价格的值

        // 发送 AJAX 请求更新数量到后端
        $.ajax({
            type: 'POST',
            url: '/frontend/cart/coupNoInstantly',
            data: {
                coupNo: coupNo,
                productDisc: productDisc,
                productRealPrice: productRealPrice,
                productAllPrice: productAllPrice
            },
            success: function (data) {
                console.log("更新優惠券總價成功");

                // 在这里，你可以根据后端返回的数据更新前端页面上对应的元素，例如更新实际价格和折扣价格的显示
                document.getElementById('productRealPrice').innerText = data.productRealPrice;
                document.getElementById('productDisc').innerText = data.productDisc;
            },
            error: function () {
                console.error('更新失败');
            }
        });
    }

    function copyBuyerInfo(checkbox) {
        var byrName = document.getElementById("productByrName").value;
        var byrPhone = document.getElementById("productByrPhone").value;
        var rcvNameInput = document.getElementById("productRcvName");
        var rcvPhoneInput = document.getElementById("productRcvPhone");

        if (checkbox.checked) {
            rcvNameInput.value = byrName;
            rcvPhoneInput.value = byrPhone;
        } else {
            rcvNameInput.value = "";
            rcvPhoneInput.value = "";
        }
    }


</script>
</body>

</html>